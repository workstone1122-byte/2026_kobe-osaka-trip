<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>登入 - 神戶大阪 5 天 4 夜</title>
    <!-- 引入 Bootstrap CSS 5.3 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <!-- 引入 Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            background-color: #f7f9fc;
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
        }
        .travel-header {
            background: linear-gradient(135deg, #007bff, #00c6ff);
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .login-container {
            max-width: 400px;
            margin: 5rem auto;
            padding: 2rem;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>

    <!-- Header 區塊 -->
    <header class="travel-header">
        <div class="container text-center">
            <h1 class="display-4"><i class="fas fa-plane-departure me-2"></i> 神戶大阪 5 天 4 夜</h1>
            <p class="lead">精彩關西之旅，請登入存取。</p>
        </div>
    </header>

    <!-- 登入表單 -->
    <main class="container">
        <div id="login-screen" class="login-container text-center">
            <h4 class="mb-4 text-primary">行程登入</h4>
            <div id="login-error" class="alert alert-danger" style="display: none;"></div>
            
            <div class="form-floating mb-3">
                <input type="email" class="form-control rounded-lg" id="email-input" placeholder="name@example.com">
                <label for="email-input">電子郵件</label>
            </div>
            <div class="form-floating mb-4">
                <input type="password" class="form-control rounded-lg" id="password-input" placeholder="密碼">
                <label for="password-input">密碼</label>
            </div>
            
            <button id="login-button" class="btn btn-primary w-100 py-2 rounded-lg" onclick="handleLogin()">
                <i class="fas fa-sign-in-alt me-2"></i> 登入行程
            </button>
            <small class="text-muted mt-3 d-block">請使用 Firebase Authentication 中已授權的帳號。</small>
        </div>
    </main>

    <!-- 1. 引入 Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    
    <script>
        // *** 請使用您專案的真實 Firebase Config ***
        const firebaseConfig = {
            apiKey: "AIzaSyBsMiLUgtJtcv48iRp_9QFx5fShtRd6Lro",
            authDomain: "kobe-osaka-2026travel.firebaseapp.com",
            projectId: "kobe-osaka-2026travel",
            storageBucket: "kobe-osaka-2026travel.firebasestorage.app",
            messagingSenderId: "772246724994",
            appId: "1:772246724994:web:26c067ae1096d13ebdef9b"
        };

        const loginErrorDiv = document.getElementById('login-error');
        let auth;

        // 初始化 Firebase 服務
        try {
            firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
        } catch (error) {
            console.error("Firebase 初始化失敗:", error);
            loginErrorDiv.textContent = 'Firebase 初始化失敗。請檢查設定。';
            loginErrorDiv.style.display = 'block';
        }

        /**
         * 處理登入邏輯
         */
        async function handleLogin() {
            const email = document.getElementById('email-input').value;
            const password = document.getElementById('password-input').value;
            const button = document.getElementById('login-button');

            loginErrorDiv.style.display = 'none';
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> 登入中...';

            try {
                await auth.signInWithEmailAndPassword(email, password);
                // 登入成功，直接跳轉到行程頁面
                window.location.href = 'trip.html'; 
            } catch (error) {
                console.error("登入失敗:", error.code, error.message);
                loginErrorDiv.textContent = '登入失敗：電子郵件或密碼不正確。';
                loginErrorDiv.style.display = 'block';
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-sign-in-alt me-2"></i> 登入行程';
            }
        }

        // 登入狀態監聽：如果使用者已經登入，直接跳轉到行程頁面
        auth.onAuthStateChanged((user) => {
            if (user) {
                window.location.href = 'trip.html';
            }
        });
    </script>
</body>
</html>